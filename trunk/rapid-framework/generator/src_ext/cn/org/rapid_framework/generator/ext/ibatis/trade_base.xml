<?xml version="1.0" encoding="UTF-8"?>
<table sqlname="trade_base"  remarks="用户信息表">
    
    <!-- 问题记录：少了一个payType参数 -->
    <operation name="findTradeBaseForAir" paging="true" paramtype="primitive" multiplicity="one" remarks="航旅交易数据查询">
		<extraparams>
			<param name="payType" javatype="java.lang.String"/>
			<param name="notInTradeFroms" javatype="java.lang.String"/>
			<param name="notInTradeStatuses" javatype="java.lang.String"/>
		</extraparams>    
    	<sql>
    	<![CDATA[
    		SELECT 
    		BTB.id,BTB.trade_no,out_trade_no,seller_account,seller_login_email,buyer_account,buyer_login_email,seller_type,buyer_type,trade_from,trade_email,operator_role,trade_status,total_fee,service_fee_ratio,service_fee,currency,seller_action,buyer_action,gmt_create,seller_user_id,buyer_user_id,additional_trd_status,trade_type,seller_fullname,buyer_fullname,seller_nick,buyer_nick,goods_title,gmt_last_modified_dt,stop_timeout,gathering_type,buyer_marker,seller_marker,buyer_marker_memo,seller_marker_memo,channel,product,pay_channel,
    		PNR,MAE.TICKET_NO_START,MAE.TICKET_NO_END,MAE.system_partner,
    		MC.BILL_NO,MC.AMOUNT,MC.TRANS_DATE,MC.TRANS_ACCOUNT_OUT,MC.TRANS_ACCOUNT_IN,MC.CUSTOMER_ID,MC.BIZ_NAME,MC.OPERATOR_ID,MC.OPERATOR_NAME,MC.MEMO,MC.loan_success,MC.pay_success
    		FROM trade_base BTB 
				inner join mcenter_air_ext MAE on BTB.trade_no = MAE.trade_no
    			left join mcenter_creditpay MC on BTB.trade_no = MC.trade_no
    		WHERE 1 = 1
    		
			<isNotEmpty property="partnerIds">
				and BTB.trade_email IN
				<iterate property="partnerIds" open="(" close=")" conjunction=",">
					#partnerIds[]#
				</iterate>
				<isEmpty prepend="and" property="account">
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>				
				</isEmpty>
			</isNotEmpty>
			
			<isNotEmpty property="account">
				<isEqual prepend="and" property="direction" compareValue="PAY">
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.buyer_account = #account#
					<isNotEmpty prepend="and" property="oppositeAccount">
						BTB.seller_account = #oppositeAccount#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.seller_nick LIKE #oppositeNick#   OR BTB.seller_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.seller_nick LIKE #oppositeFullName#   OR BTB.seller_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.seller_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>
				</isEqual>
				<isEqual prepend="and" property="direction" compareValue="RECEIVE">
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.seller_account = #account#
					<isNotEmpty prepend="and" property="oppositeAccount">
						BTB.buyer_account = #oppositeAccount#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.buyer_nick LIKE #oppositeNick#  OR BTB.buyer_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.buyer_nick LIKE #oppositeFullName#  OR BTB.buyer_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.buyer_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>
				</isEqual>
				<isEqual prepend="and" property="direction" compareValue="ALL">
					((
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.buyer_account = #account# 
					<isNotEmpty prepend="and" property="oppositeAccount">
						(BTB.seller_account = #oppositeAccount#)
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.seller_nick LIKE #oppositeNick#   OR BTB.seller_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.seller_nick LIKE #oppositeFullName#   OR BTB.seller_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.seller_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>					
					)
					OR
					(
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.seller_account = #account# 					
					<isNotEmpty prepend="and" property="oppositeAccount">
						BTB.buyer_account = #oppositeAccount#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.buyer_nick LIKE #oppositeNick#  OR BTB.buyer_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.buyer_nick LIKE #oppositeFullName#  OR BTB.buyer_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.buyer_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>
					))					
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeNo">
				BTB.trade_no = #tradeNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="outTradeNo">
				BTB.out_trade_no = #outTradeNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeTypes">
				BTB.trade_type IN
				<iterate property="tradeTypes" open="(" close=")" conjunction=",">
					#tradeTypes[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeStatuses">
				 BTB.trade_status IN
				<iterate property="tradeStatuses" open="(" close=")" conjunction=",">
					#tradeStatuses[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="notInTradeStatuses">
				 BTB.trade_status NOT IN
				<iterate property="notInTradeStatuses" open="(" close=")" conjunction=",">
					#notInTradeStatuses[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="goodsTitle">
				BTB.goods_title LIKE #goodsTitle# 
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeFroms">
				BTB.trade_from IN
				<iterate property="tradeFroms" open="(" close=")" conjunction=",">
					#tradeFroms[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="notInTradeFroms">
				BTB.trade_from NOT IN
				<iterate property="notInTradeFroms" open="(" close=")" conjunction=",">
					#notInTradeFroms[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradePriceDown">
					BTB.total_fee &gt;= #tradePriceDown#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="tradePriceUp">
					BTB.total_fee &lt;= #tradePriceUp#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="gmtLastModifiedDtStartTime">
					BTB.gmt_last_modified_dt &gt;= #gmtLastModifiedDtStartTime#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="gmtLastModifiedDtEndTime">
					BTB.gmt_last_modified_dt &lt;= #gmtLastModifiedDtEndTime#
			</isNotEmpty> 	
			
			<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
			</isNotEmpty>
			
			<isEqual prepend="and" property="payType" compareValue="BALANCE_PAY">
					MC.pay_success is null
			</isEqual>
			<isEqual prepend="and" property="payType" compareValue="CREDIT_PAY">
					MC.pay_success = 'Y'
			</isEqual>			
		]]>
		</sql>
    </operation>

    <!-- 问题记录：少了一个payType参数 -->
    <operation name="countAndSumTradeBaseForAir" paramtype="primitive" multiplicity="one" remarks="航旅交易数据汇总查询">
		<extraparams>
			<param name="payType" javatype="java.lang.String"/>
			<param name="notInTradeFroms" javatype="java.lang.String"/>
			<param name="notInTradeStatuses" javatype="java.lang.String"/>			
		</extraparams>    
    	<sql>
    	<![CDATA[
    		SELECT 
    			count(*) count,sum(amount) sum_amount
    		FROM trade_base BTB 
				inner join mcenter_air_ext MAE on BTB.trade_no = MAE.trade_no
    			left join mcenter_creditpay MC on BTB.trade_no = MC.trade_no
    		WHERE 1 = 1
    		
			<isNotEmpty property="partnerIds">
				and BTB.trade_email IN
				<iterate property="partnerIds" open="(" close=")" conjunction=",">
					#partnerIds[]#
				</iterate>
				<isEmpty prepend="and" property="account">
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>				
				</isEmpty>
			</isNotEmpty>
			
			<isNotEmpty property="account">
				<isEqual prepend="and" property="direction" compareValue="PAY">
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.buyer_account = #account#
					<isNotEmpty prepend="and" property="oppositeAccount">
						BTB.seller_account = #oppositeAccount#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.seller_nick LIKE #oppositeNick#   OR BTB.seller_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.seller_nick LIKE #oppositeFullName#   OR BTB.seller_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.seller_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>
				</isEqual>
				<isEqual prepend="and" property="direction" compareValue="RECEIVE">
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.seller_account = #account#
					<isNotEmpty prepend="and" property="oppositeAccount">
						BTB.buyer_account = #oppositeAccount#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.buyer_nick LIKE #oppositeNick#  OR BTB.buyer_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.buyer_nick LIKE #oppositeFullName#  OR BTB.buyer_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.buyer_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>
				</isEqual>
				<isEqual prepend="and" property="direction" compareValue="ALL">
					((
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.buyer_account = #account# 
					<isNotEmpty prepend="and" property="oppositeAccount">
						(BTB.seller_account = #oppositeAccount#)
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.seller_nick LIKE #oppositeNick#   OR BTB.seller_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.seller_nick LIKE #oppositeFullName#   OR BTB.seller_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.seller_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>					
					)
					OR
					(
					BTB.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTB.seller_account = #account# 					
					<isNotEmpty prepend="and" property="oppositeAccount">
						BTB.buyer_account = #oppositeAccount#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeNick">
						(BTB.buyer_nick LIKE #oppositeNick#  OR BTB.buyer_fullname LIKE #oppositeNick# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeFullName">
						(BTB.buyer_nick LIKE #oppositeFullName#  OR BTB.buyer_fullname LIKE #oppositeFullName# )
					</isNotEmpty>
					<isNotEmpty prepend="and" property="oppositeLoginName">
						BTB.buyer_login_email LIKE #oppositeLoginName# 
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateStartTime">
						BTB.gmt_create &gt;= #gmtCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtCreateEndTime">
						BTB.gmt_create &lt;= #gmtCreateEndTime#
					</isNotEmpty>
					))					
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeNo">
				BTB.trade_no = #tradeNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="outTradeNo">
				BTB.out_trade_no = #outTradeNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeTypes">
				BTB.trade_type IN
				<iterate property="tradeTypes" open="(" close=")" conjunction=",">
					#tradeTypes[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeStatuses">
				 BTB.trade_status IN
				<iterate property="tradeStatuses" open="(" close=")" conjunction=",">
					#tradeStatuses[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="notInTradeStatuses">
				 BTB.trade_status NOT IN
				<iterate property="notInTradeStatuses" open="(" close=")" conjunction=",">
					#notInTradeStatuses[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="goodsTitle">
				BTB.goods_title LIKE #goodsTitle# 
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeFroms">
				BTB.trade_from IN
				<iterate property="tradeFroms" open="(" close=")" conjunction=",">
					#tradeFroms[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="notInTradeFroms">
				BTB.trade_from NOT IN
				<iterate property="notInTradeFroms" open="(" close=")" conjunction=",">
					#notInTradeFroms[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradePriceDown">
					BTB.total_fee &gt;= #tradePriceDown#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="tradePriceUp">
					BTB.total_fee &lt;= #tradePriceUp#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="gmtLastModifiedDtStartTime">
					BTB.gmt_last_modified_dt &gt;= #gmtLastModifiedDtStartTime#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="gmtLastModifiedDtEndTime">
					BTB.gmt_last_modified_dt &lt;= #gmtLastModifiedDtEndTime#
			</isNotEmpty> 	
			
			<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
			</isNotEmpty>
			
			<isEqual prepend="and" property="payType" compareValue="BALANCE_PAY">
					MC.pay_success is null
			</isEqual>
			<isEqual prepend="and" property="payType" compareValue="CREDIT_PAY">
					MC.pay_success = 'Y'
			</isEqual>			
		]]>
		</sql>
    </operation>
    
	<operation name="findTradeFundBillForAir" paging="true" paramtype="primitive" remarks="退款明细查询">
    	<sql>
    	<![CDATA[
    	SELECT BTF.bill_no,BTF.trade_no,out_order_no,pay_account_no,receive_account_no,currency,BTF.amount,type,status,channel,gmt_pay,iw_trans_log_id,BTF.gmt_trade_create,BTF.gmt_create,BTF.gmt_modified,BTF.memo,bank_pay_online_id,bank_amount,bank_type,freeze_type,partner_id,deposit_id,
    		PNR,MAE.TICKET_NO_START,MAE.TICKET_NO_END,MAE.system_partner,
    		MC.BILL_NO,MC.AMOUNT,MC.TRANS_DATE,MC.TRANS_ACCOUNT_OUT,MC.TRANS_ACCOUNT_IN,MC.CUSTOMER_ID,MC.BIZ_NAME,MC.OPERATOR_ID,MC.OPERATOR_NAME,MC.MEMO,MC.loan_success,MC.pay_success
    	from trade_fund_bill BTF
			inner join mcenter_air_ext MAE on BTF.trade_no = MAE.trade_no
    		left join mcenter_creditpay MC on BTF.trade_no = MC.trade_no
    	WHERE 1 = 1    
			<isNotEmpty property="partnerIds">
				<isEmpty prepend="and" property="account">
					BTF.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					<isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
						BTF.gmt_trade_create &gt;= #gmtTradeCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
						BTF.gmt_trade_create &lt;= #gmtTradeCreateEndTime#
					</isNotEmpty>					
				</isEmpty>
				
				 and BTF.partner_id IN
				<iterate property="partnerIds" open="(" close=")" conjunction=",">
					#partnerIds[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="tradeNo">
				BTF.trade_no = #tradeNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="outTradeNo">
				BTF.out_order_no = #outTradeNo#
			</isNotEmpty>
			
			<isNotEmpty property="account">
				<isEqual prepend="and" property="direction" compareValue="PAY">
					BTF.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTF.pay_account_no = #account#
					<isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
							BTF.gmt_trade_create &gt;= #gmtTradeCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
							BTF.gmt_trade_create &lt;= #gmtTradeCreateEndTime#
					</isNotEmpty>					
				</isEqual>
				<isEqual prepend="and" property="direction" compareValue="RECEIVE">
					BTF.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					and BTF.receive_account_no = #account#
					<isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
							BTF.gmt_trade_create &gt;= #gmtTradeCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
							BTF.gmt_trade_create &lt;= #gmtTradeCreateEndTime#
					</isNotEmpty>					
				</isEqual>
				<isEqual prepend="and" property="direction" compareValue="ALL">
					(
					(BTF.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					 	and BTF.pay_account_no = #account#
					 <isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
						BTF.gmt_trade_create &gt;= #gmtTradeCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
						BTF.gmt_trade_create &lt;= #gmtTradeCreateEndTime#
					</isNotEmpty>
					)
					 OR 
					(BTF.owner IN <iterate property="owner" open="(" close=")" conjunction=",">#owner[]#</iterate>
					 	and BTF.receive_account_no = #account#
					<isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
							BTF.gmt_trade_create &gt;= #gmtTradeCreateStartTime#
					</isNotEmpty>
					<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
							BTF.gmt_trade_create &lt;= #gmtTradeCreateEndTime#
					</isNotEmpty>
					 ))
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="memo">
				BTF.memo like #memo# 
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="fundFlowTypes">
				 BTF.type IN
				<iterate property="fundFlowTypes" open="(" close=")" conjunction=",">
					#fundFlowTypes[]#
				</iterate>
			</isNotEmpty>

			<isNotEmpty prepend="and" property="minAmount">
				BTF.amount >= #minAmount#
			</isNotEmpty>

			<isNotEmpty prepend="and" property="maxAmount">
				BTF.amount &lt;= #maxAmount#
			</isNotEmpty>
									
			<isNotEmpty prepend="and" property="fundBillStatuses">
				 BTF.status IN
				<iterate property="fundBillStatuses" open="(" close=")" conjunction=",">
					#fundBillStatuses[]#
				</iterate>
			</isNotEmpty>
						
			<isNotEmpty prepend="and" property="gmtPayStartTime">
					BTF.gmt_pay &gt;= #gmtPayStartTime#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="gmtPayEndTime">
					BTF.gmt_pay &lt;= #gmtPayEndTime#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
			</isNotEmpty>	
			
			<isEqual prepend="and" property="payType" compareValue="BALANCE_PAY">
					MC.pay_success is null
			</isEqual>
			<isEqual prepend="and" property="payType" compareValue="CREDIT_PAY">
					MC.pay_success = 'Y'
			</isEqual>						    		
		]]>
		</sql>
    </operation> 
    
    
 	<!-- 
     private String       iwAccountLogId;     // 帐户明细userId
    private String       tradeNo;
    private String       outTradeNo; //还未使用

    private String       accountNo;
    private String       otherAccountNo;
    private String       blanceAction; //还未使用
    private List<String>       transCodes;
    private List<String>       subTransCodes;
    private List<String> excludeTransCodes;
    private String       pnr;
    private String       ticketNo;
    private List<String> partnerIdList;
    private Date         gmtCreateEndTime;
    private Date         gmtCreateStartTime;
    
    private String orderNo;
    private Money minAmount; 
    private Money maxAmount;
    private String bankName;
    private String memo; //还未使用
    
    private PayTypeEnum payType; //还未使用
    
        <isNotEmpty prepend="and" property="outTradeNo">
			MAL.out_trade_no = #outTradeNo#
		</isNotEmpty>
 	 -->
       
	<operation name="findAccountLogWithAirExt" paging="true" paramtype="primitive" remarks="帐务明细查询">
    	<sql>
    	<![CDATA[
    	SELECT 
    	IW_ACCOUNT_LOG_ID,TRANS_LOG_ID,TRANS_DATE,OUT_DATE,TRANS_DT,TRANS_CODE,TRANS_AMOUNT,BALANCE,TRANS_CURRENCY,ACCOUNT_TYPE,TRANS_ACCOUNT,OTHER_ACCOUNT_TYPE,OTHER_ACCOUNT,TRANS_INSTITUTION,TRANS_OUT_ORDER_NO,BANK_NAME,TRANS_MEMO,SUB_TRANS_CODE,OUT_BIZ_NO,MODEL,SUITE_ID,IS_WRITE_OFF,IS_RED,OTHER_ACCOUNT_LOG,DELETE_FLAG,VOUCHER_ID,ORGI_VOUCHER_ID,TRANS_OPERATOR,INST_CHANNEL_API,REAL_TRADE_NO,PAY_TYPE,TRADE_NO,
    	PNR,TICKET_NO_START,TICKET_NO_END,system_partner,gmt_trade_create  
    	from mcenter_account_log MAL
			inner join mcenter_air_ext MAE on MAL.real_trade_no = MAE.trade_no
    	WHERE 1 = 1
	    	<isNotEmpty prepend="and" property="iwAccountLogId">
				MAL.IW_ACCOUNT_LOG_ID = ?
			</isNotEmpty> 
			
	    	<isNotEmpty prepend="and" property="tradeNo">
				MAL.real_trade_no = #tradeNo#
			</isNotEmpty>
			
	    	<isNotEmpty prepend="and" property="accountNo">
				MAL.trans_account = #accountNo#
			</isNotEmpty>
			
	    	<isNotEmpty prepend="and" property="otherAccountNo">
				MAL.other_account = #otherAccountNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="transCodes">
					 MAL.trans_code IN
					<iterate property="transCodes" open="(" close=")" conjunction=",">
						#transCodes[]#
					</iterate>
			</isNotEmpty>
	
			<isNotEmpty prepend="and" property="excludeTransCodes">
					 MAL.trans_code NOT IN
					<iterate property="excludeTransCodes" open="(" close=")" conjunction=",">
						#excludeTransCodes[]#
					</iterate>
			</isNotEmpty>
					
			<isNotEmpty prepend="and" property="subTransCodes">
					 MAL.sub_trans_code IN
					<iterate property="subTransCodes" open="(" close=")" conjunction=",">
						#subTransCodes[]#
					</iterate>
			</isNotEmpty>	

			<isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
					MAL.trans_dt &gt;= #gmtCreateStartTime#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
					MAL.trans_dt &lt;= #gmtCreateEndTime#
			</isNotEmpty>	

			<isNotEmpty prepend="and" property="minTransAmount">
					MAL.TRANS_AMOUNT >= #minTransAmount#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="maxTransAmount">
					MAL.TRANS_AMOUNT &lt;= #maxTransAmount#
			</isNotEmpty>

			<isNotEmpty prepend="and" property="bankName">
					MAL.bank_name = #bankName#
			</isNotEmpty>
									
			<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
			</isNotEmpty>														   
		]]>
		</sql>
    </operation>    
    
    <!-- 缺少isIncomeOrOutcome参数传递 -->
	<operation name="countAndSumAccountInfo" paging="true" paramtype="primitive" remarks="退款明细汇总查询">
		<sql>
    	<![CDATA[
    	SELECT count(*) count,sum(TRANS_AMOUNT) sumTransAmount
    	from mcenter_account_log MAL
			inner join mcenter_air_ext MAE on MAL.real_trade_no = MAE.trade_no
    	WHERE 1 = 1
	    	<isEqual prepend="and" property="isIncomeOrOutcome" compareValue="INCOME">
				MAL.TRANS_AMOUNT > 0
			</isEqual> 
	    	<isEqual prepend="and" property="isIncomeOrOutcome" compareValue="OUTCOME">
				MAL.TRANS_AMOUNT < 0
			</isEqual>
						    	
	    	<isNotEmpty prepend="and" property="iwAccountLogId">
				MAL.IW_ACCOUNT_LOG_ID = ?
			</isNotEmpty> 
			
	    	<isNotEmpty prepend="and" property="tradeNo">
				MAL.real_trade_no = #tradeNo#
			</isNotEmpty>
			
	    	<isNotEmpty prepend="and" property="accountNo">
				MAL.trans_account = #accountNo#
			</isNotEmpty>
			
	    	<isNotEmpty prepend="and" property="otherAccountNo">
				MAL.other_account = #otherAccountNo#
			</isNotEmpty>
			
			<isNotEmpty prepend="and" property="transCodes">
					 MAL.trans_code IN
					<iterate property="transCodes" open="(" close=")" conjunction=",">
						#transCodes[]#
					</iterate>
			</isNotEmpty>
	
			<isNotEmpty prepend="and" property="excludeTransCodes">
					 MAL.trans_code NOT IN
					<iterate property="excludeTransCodes" open="(" close=")" conjunction=",">
						#excludeTransCodes[]#
					</iterate>
			</isNotEmpty>
					
			<isNotEmpty prepend="and" property="subTransCodes">
					 MAL.sub_trans_code IN
					<iterate property="subTransCodes" open="(" close=")" conjunction=",">
						#subTransCodes[]#
					</iterate>
			</isNotEmpty>	

			<isNotEmpty prepend="and" property="gmtTradeCreateStartTime">
					MAL.trans_dt &gt;= #gmtCreateStartTime#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="gmtTradeCreateEndTime">
					MAL.trans_dt &lt;= #gmtCreateEndTime#
			</isNotEmpty>	

			<isNotEmpty prepend="and" property="minTransAmount">
					MAL.TRANS_AMOUNT >= #minTransAmount#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="maxTransAmount">
					MAL.TRANS_AMOUNT &lt;= #maxTransAmount#
			</isNotEmpty>

			<isNotEmpty prepend="and" property="bankName">
					MAL.bank_name = #bankName#
			</isNotEmpty>
									
			<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
			</isNotEmpty>														   
		]]>
		</sql>
    </operation>
    
	<operation name="findCreditpayDetail" paging="true" remarks="信用支付明细分页查询">
		<extraparams>
			<param name="tradeNo" javatype="java.lang.String"/>
		</extraparams>
		<sql>
			<![CDATA[
	    	SELECT 
		        BILL_NO ,MC.TRADE_NO ,AMOUNT ,TRANS_DATE ,TRANS_ACCOUNT_OUT ,TRANS_ACCOUNT_IN ,CUSTOMER_ID ,BIZ_NAME ,OPERATOR_ID ,OPERATOR_NAME ,MEMO ,loan_success ,pay_success ,MC.gmt_trade_create,
    			PNR,TICKET_NO_START,TICKET_NO_END,system_partner,MAE.gmt_trade_create,
    			id,BTB.trade_no,out_trade_no,seller_account,seller_login_email,buyer_account,buyer_login_email,seller_type,buyer_type,trade_from,trade_email,operator_role,trade_status,total_fee,service_fee_ratio,service_fee,currency,seller_action,buyer_action,gmt_create,seller_user_id,buyer_user_id,additional_trd_status,trade_type,seller_fullname,buyer_fullname,seller_nick,buyer_nick,goods_title,gmt_last_modified_dt,stop_timeout,gathering_type,buyer_marker,seller_marker,buyer_marker_memo,seller_marker_memo,channel,product,pay_channel
		    FROM mcenter_creditpay MC
		    	inner join mcenter_air_ext MAE on MC.trade_no = MAE.trade_no 
		    	inner join trade_base BTB on MC.trade_no = BTB.trade_no
		    WHERE 1 = 1
				<isNotEmpty prepend="and" property="billNo">
						MC.bill_no = #billNo#
				</isNotEmpty>		    
		       <isNotEmpty prepend="AND" property="tradeNo">
		             MC.TRADE_NO = #tradeNo#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="amount">
		             MC.AMOUNT = #amount#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="transDate">
		             MC.TRANS_DATE = #transDate#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="transAccountOut">
		             MC.TRANS_ACCOUNT_OUT = #transAccountOut#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="transAccountIn">
		             MC.TRANS_ACCOUNT_IN = #transAccountIn#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="customerId">
		             MC.CUSTOMER_ID = #customerId#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="bizName">
		             MC.BIZ_NAME = #bizName#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="operatorId">
		             MC.OPERATOR_ID = #operatorId#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="operatorName">
		             MC.OPERATOR_NAME = #operatorName#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="memo">
		             MC.MEMO = #memo#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="recordStamp">
		             MC.RECORD_STAMP = #recordStamp#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="loanSuccess">
		             MC.loan_success = #loanSuccess#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="paySuccess">
		             MC.pay_success = #paySuccess#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="gmtTradeCreateBegin">
		             MC.gmt_trade_create &gt;= #gmtTradeCreateBegin#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="gmtTradeCreateEnd">
		             MC.gmt_trade_create &lt;= #gmtTradeCreateEnd#
		       </isNotEmpty>
		       
		       <isNotEmpty prepend="AND" property="outTradeNo">
		             BTB.out_trade_no = #outTradeNo#
		       </isNotEmpty>

				<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
				</isNotEmpty>
				
	    		<isNotEmpty property="orderby">
	    			ORDER BY #orderby#
	    		</isNotEmpty>
		    ]]>
		</sql>		
	</operation>  
	
	<operation name="findCreditpayRefundDetail" paging="true" remarks="信用支付退款明细分页查询">
		<extraparams>
			<param name="tradeNo" javatype="java.lang.String"/>
		</extraparams>
		<sql>
			<![CDATA[
	    	SELECT BTF.bill_no,BTF.trade_no,out_order_no,pay_account_no,receive_account_no,BTF.currency,BTF.amount,type,status,BTF.channel,gmt_pay,iw_trans_log_id,BTF.gmt_trade_create,BTF.gmt_create,BTF.gmt_modified,BTF.memo,bank_pay_online_id,bank_amount,bank_type,freeze_type,partner_id,deposit_id,
	    		PNR,MAE.TICKET_NO_START,MAE.TICKET_NO_END,MAE.system_partner,
	    		MC.BILL_NO,MC.AMOUNT,MC.TRANS_DATE,MC.TRANS_ACCOUNT_OUT,MC.TRANS_ACCOUNT_IN,MC.CUSTOMER_ID,MC.BIZ_NAME,MC.OPERATOR_ID,MC.OPERATOR_NAME,MC.MEMO,MC.loan_success,MC.pay_success
	    	from trade_fund_bill BTF
				inner join mcenter_air_ext MAE on BTF.trade_no = MAE.trade_no
	    		left join mcenter_creditpay MC on BTF.trade_no = MC.trade_no
	    		inner join trade_base BTB on MC.trade_no = BTB.trade_no
	    	WHERE 1 = 1    
				<isNotEmpty prepend="and" property="billNo">
						MC.bill_no = #billNo#
				</isNotEmpty>		    
		       <isNotEmpty prepend="AND" property="tradeNo">
		             MC.TRADE_NO = #tradeNo#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="amount">
		             MC.AMOUNT = #amount#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="transDate">
		             MC.TRANS_DATE = #transDate#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="transAccountOut">
		             MC.TRANS_ACCOUNT_OUT = #transAccountOut#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="transAccountIn">
		             MC.TRANS_ACCOUNT_IN = #transAccountIn#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="customerId">
		             MC.CUSTOMER_ID = #customerId#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="bizName">
		             MC.BIZ_NAME = #bizName#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="operatorId">
		             MC.OPERATOR_ID = #operatorId#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="operatorName">
		             MC.OPERATOR_NAME = #operatorName#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="memo">
		             MC.MEMO = #memo#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="recordStamp">
		             MC.RECORD_STAMP = #recordStamp#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="loanSuccess">
		             MC.loan_success = #loanSuccess#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="paySuccess">
		             MC.pay_success = #paySuccess#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="gmtTradeCreateBegin">
		             MC.gmt_trade_create &gt;= #gmtTradeCreateBegin#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="gmtTradeCreateEnd">
		             MC.gmt_trade_create &lt;= #gmtTradeCreateEnd#
		       </isNotEmpty>
		       
		       <isNotEmpty prepend="AND" property="outTradeNo">
		             BTB.out_trade_no = #outTradeNo#
		       </isNotEmpty>

				<isNotEmpty prepend="and" property="pnr">
					MAE.pnr = #pnr#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_END >= #ticketNo#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="ticketNo">
					MAE.TICKET_NO_START &lt;= #ticketNo#
				</isNotEmpty>
				
	    		<isNotEmpty property="orderby">
	    			ORDER BY #orderby#
	    		</isNotEmpty>
		    ]]>
		</sql>		
	</operation> 	         			
</table>
