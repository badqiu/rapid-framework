<?xml version="1.0"?>
<!--
  ~ Artifactory is a binaries repository manager.
  ~ Copyright (C) 2011 JFrog Ltd.
  ~
  ~ Artifactory is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Lesser General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ Artifactory is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Lesser General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Lesser General Public License
  ~ along with Artifactory.  If not, see <http://www.gnu.org/licenses/>.
  -->

<!DOCTYPE configuration SYSTEM "http://jackrabbit.apache.org/dtd/indexing-configuration-1.2.dtd">
<configuration xmlns:nt="http://www.jcp.org/jcr/nt/1.0"
               xmlns:jcr="http://www.jcp.org/jcr/1.0"
               xmlns:artifactory="http://artifactory.jfrog.org/1.0"
               xmlns:ocm="http://jackrabbit.apache.org/ocm">

    <!-- Put specific rules first - this is how they are applied internally at runtime -->

    <index-rule nodeType="artifactory:file">
        <property nodeScopeIndex="false" useInExcerpt="false" boost="2.0">artifactory:name</property>
        <property nodeScopeIndex="false" useInExcerpt="true">artifactory:archiveEntry</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:archiveIndexed</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:checksum.md5.actual</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:checksum.md5.original</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:checksum.sha1.actual</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:checksum.sha1.original</property>
    </index-rule>

    <index-rule nodeType="artifactory:folder">
        <property nodeScopeIndex="false" useInExcerpt="false" boost="2.0">artifactory:name</property>
    </index-rule>

    <index-rule nodeType="artifactory:metadata">
        <!-- Stats props -->
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:downloadCount</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:lastDownloaded</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:lastDownloadedBy</property>
        <!-- Global default -->
        <property nodeScopeIndex="false" useInExcerpt="false" isRegexp="true">.*</property>
    </index-rule>

    <index-rule nodeType="artifactory:logEntry">
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:timestamp</property>
    </index-rule>

    <index-rule nodeType="nt:unstructured">
        <!-- artifactory:base mixin properties -->
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:created</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:createdBy</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:lastModified</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:lastModifiedBy</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:lastUpdated</property>

        <!-- build item checksums -->
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:build.artifact.checksums</property>
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:build.dependency.checksums</property>

        <!-- Metadata element name property -->
        <property nodeScopeIndex="false" useInExcerpt="false">artifactory:metadataName</property>

        <!--
        nodeScopeIndex="false" will also cause properties not to be used in excerpts by default, since to be used in
        excerpts a property also need to be indexed on the node level.
         -->
        <property nodeScopeIndex="true" useInExcerpt="false">ocm:ocm_classname</property>

        <!-- Jcr props settings have limited effect -->
        <property nodeScopeIndex="false" useInExcerpt="false">jcr:xmlcharacters</property>
        <property nodeScopeIndex="false" useInExcerpt="false">jcr:encoding</property>
        <property nodeScopeIndex="false" useInExcerpt="false">jcr:mimeType</property>

        <!-- Global default -->
        <property nodeScopeIndex="false" useInExcerpt="false" isRegexp="true">.*</property>
    </index-rule>

    <analyzers>
        <analyzer class="org.artifactory.search.lucene.ArtifactNameAnalyzer">
            <property>artifactory:name</property>
        </analyzer>
        <analyzer class="org.artifactory.search.lucene.ArchiveEntryAnalyzer">
            <property>artifactory:archiveEntry</property>
        </analyzer>
    </analyzers>
</configuration>